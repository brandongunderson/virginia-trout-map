(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[228],{3228:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return L}});var n,a,o,s,i=r(8710),l=r(1930);let c=(0,l.createContext)(null),u=c.Provider;function d(){let e=(0,l.useContext)(c);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}var p=r(4512);function m(){return(m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}let f=(0,l.forwardRef)(function({bounds:e,boundsOptions:t,center:r,children:n,className:a,id:o,placeholder:s,style:i,whenReady:c,zoom:d,...f},g){let[y]=(0,l.useState)({className:a,id:o,style:i}),[S,h]=(0,l.useState)(null);(0,l.useImperativeHandle)(g,()=>S?.map??null,[S]);let E=(0,l.useCallback)(n=>{if(null!==n&&null===S){let a=new p.Map(n,f);null!=r&&null!=d?a.setView(r,d):null!=e&&a.fitBounds(e,t),null!=c&&a.whenReady(c),h(Object.freeze({__version:1,map:a}))}},[]);(0,l.useEffect)(()=>()=>{S?.map.remove()},[S]);let x=S?l.createElement(u,{value:S},n):s??null;return l.createElement("div",m({},y,{ref:E}),x)});function g(e,t){let r=e.pane??t.pane;return r?{...e,pane:r}:e}r(4002);let y=(n=function({url:e,...t},r){return Object.freeze({instance:new p.TileLayer(e,g(t,r)),context:r,container:void 0})},a=function(e,t,r){!function(e,t,r){let{opacity:n,zIndex:a}=t;null!=n&&n!==r.opacity&&e.setOpacity(n),null!=a&&a!==r.zIndex&&e.setZIndex(a)}(e,t,r);let{url:n}=t;null!=n&&n!==r.url&&e.setUrl(n)},o=function(e,t){let r=(0,l.useRef)();r.current||(r.current=n(e,t));let o=(0,l.useRef)(e),{instance:s}=r.current;return(0,l.useEffect)(function(){o.current!==e&&(a(s,e,o.current),o.current=e)},[s,e,t]),r},s=function(e){var t;let r=d(),n=o(g(e,r),r);return function(e,t){let r=(0,l.useRef)(t);(0,l.useEffect)(function(){t!==r.current&&null!=e.attributionControl&&(null!=r.current&&e.attributionControl.removeAttribution(r.current),null!=t&&e.attributionControl.addAttribution(t)),r.current=t},[e,t])}(r.map,e.attribution),function(e,t){let r=(0,l.useRef)();(0,l.useEffect)(function(){return null!=t&&e.instance.on(t),r.current=t,function(){null!=r.current&&e.instance.off(r.current),r.current=null}},[e,t])}(n.current,e.eventHandlers),t=n.current,(0,l.useEffect)(function(){return(r.layerContainer??r.map).addLayer(t.instance),function(){r.layerContainer?.removeLayer(t.instance),r.map.removeLayer(t.instance)}},[r,t]),n},(0,l.forwardRef)(function(e,t){let{instance:r}=s(e).current;return(0,l.useImperativeHandle)(t,()=>r),null}));var S=r(389);let h="https://services.dwr.virginia.gov/arcgis/rest/services/Projects/TroutApp/MapServer",E={TROUT_STREAMS:0,STOCKING_LOCATIONS:1,STOCKING_EVENTS:2,TROUT_REGULATIONS:3,PUBLIC_LAKES:4,WILDLIFE_MANAGEMENT_AREAS:5},x={[E.TROUT_STREAMS]:"Trout Streams",[E.STOCKING_LOCATIONS]:"Stocking Locations",[E.STOCKING_EVENTS]:"Stocking Events",[E.TROUT_REGULATIONS]:"Trout Regulations",[E.PUBLIC_LAKES]:"Public Lakes",[E.WILDLIFE_MANAGEMENT_AREAS]:"Wildlife Management Areas"},T={[E.TROUT_STREAMS]:{color:"#2563eb",weight:3,opacity:.8},[E.STOCKING_LOCATIONS]:{color:"#10b981",radius:6,fillOpacity:.7,opacity:1},[E.STOCKING_EVENTS]:{color:"#f59e0b",radius:5,fillOpacity:.6,opacity:.9},[E.TROUT_REGULATIONS]:{color:"#8b5cf6",weight:2,fillOpacity:.3,opacity:.7},[E.PUBLIC_LAKES]:{color:"#06b6d4",weight:2,fillOpacity:.4,opacity:.8},[E.WILDLIFE_MANAGEMENT_AREAS]:{color:"#84cc16",weight:2,fillOpacity:.2,opacity:.6}},N={STREET:{name:"Street",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},TOPO:{name:"Topographic",url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",attribution:'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, SRTM | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a>'},SATELLITE:{name:"Satellite",url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"}};async function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1=1",r=new URLSearchParams({where:t,outFields:"*",returnGeometry:"true",f:"json",outSR:"4326"}),n="".concat(h,"/").concat(e,"/query?").concat(r.toString()),a=await fetch(n);if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));return{success:!0,data:await a.json()}}function v(e,t){return"esriGeometryPoint"===t&&void 0!==e.x&&void 0!==e.y?{type:"Point",coordinates:[e.x,e.y]}:"esriGeometryPolyline"===t&&e.paths?{type:1===e.paths.length?"LineString":"MultiLineString",coordinates:1===e.paths.length?e.paths[0]:e.paths}:"esriGeometryPolygon"===t&&e.rings?{type:1===e.rings.length?"Polygon":"MultiPolygon",coordinates:1===e.rings.length?[e.rings[0]]:e.rings}:{type:"Point",coordinates:[0,0]}}async function A(e){var t;let r=await b(E.TROUT_STREAMS,e?"COUNTY = '".concat(e,"'"):"1=1");return(null===(t=r.data)||void 0===t?void 0:t.features)?r.data.features.map(e=>{let t=e.attributes;return{id:String(t.OBJECTID||t.FID||t.ID||"unknown"),name:String(t.NAME||t.WATER_NAME||t.STREAM_NAME||"Unnamed Stream"),county:String(t.COUNTY||t.COUNTY_NAME||"Unknown"),species:String(t.SPECIES||t.TROUT_SPECIES||"").split(",").map(e=>e.trim()).filter(Boolean),waterType:String(t.WATER_TYPE||t.TYPE||"Stream"),regulation:String(t.REGULATION||t.REG_TYPE||"General"),geometry:v(e.geometry,"esriGeometryPolyline"),properties:t}}):[]}async function O(e){var t;let r=await b(E.STOCKING_LOCATIONS,e?"COUNTY = '".concat(e,"'"):"1=1");return(null===(t=r.data)||void 0===t?void 0:t.features)?r.data.features.map(e=>{let t=e.attributes;return{id:String(t.OBJECTID||t.FID||t.ID||"unknown"),name:String(t.NAME||t.LOCATION||t.LOCATION_NAME||"Unnamed Location"),county:String(t.COUNTY||t.COUNTY_NAME||"Unknown"),species:String(t.SPECIES||t.TROUT_SPECIES||"Unknown"),stockingDate:String(t.STOCKING_DATE||t.STOCK_DATE||""),waterBody:String(t.WATER_BODY||t.WATER_NAME||t.NAME||""),geometry:v(e.geometry,"esriGeometryPoint"),properties:t}}):[]}async function I(e){var t;let r=await b(E.PUBLIC_LAKES,e?"COUNTY = '".concat(e,"'"):"1=1");return(null===(t=r.data)||void 0===t?void 0:t.features)?r.data.features.map(e=>{let t=e.attributes;return{id:String(t.OBJECTID||t.FID||t.ID||"unknown"),name:String(t.NAME||t.LAKE_NAME||t.WATER_NAME||"Unnamed Lake"),county:String(t.COUNTY||t.COUNTY_NAME||"Unknown"),acres:parseFloat(String(t.ACRES||t.AREA_ACRES||0)),species:String(t.SPECIES||t.FISH_SPECIES||"").split(",").map(e=>e.trim()).filter(Boolean),geometry:v(e.geometry,"esriGeometryPolygon"),properties:t}}):[]}async function C(){try{let[e,t,r]=await Promise.all([A(),O(),I()]);return{streams:e,locations:t,lakes:r}}catch(e){throw console.error("Error fetching ArcGIS layers:",e),e}}function w(e){let{activeLayers:t}=e,r=d().map,[n,a]=(0,l.useState)(!1),o=(0,l.useRef)(null);return(0,l.useEffect)(()=>{var e;if(null===(e=window.L)||void 0===e?void 0:e.esri){a(!0);return}let t=document.createElement("script");return t.src="https://unpkg.com/esri-leaflet@3.0.10/dist/esri-leaflet.js",t.async=!0,t.onload=()=>{console.log("ESRI-Leaflet loaded successfully"),a(!0)},t.onerror=()=>{console.error("Failed to load ESRI-Leaflet")},document.body.appendChild(t),()=>{document.body.contains(t)&&document.body.removeChild(t)}},[]),(0,l.useEffect)(()=>{var e;if(!n||!(null===(e=window.L)||void 0===e?void 0:e.esri)||!r)return;o.current&&r.removeLayer(o.current);let a=Array.from(t);if(a.length>0)try{o.current=window.L.esri.dynamicMapLayer({url:h,layers:a,opacity:.8}),o.current.addTo(r),console.log("ESRI dynamic layers added:",a)}catch(e){console.error("Error creating ESRI dynamic layer:",e)}return()=>{o.current&&r&&r.removeLayer(o.current)}},[n,t,r]),null}function L(){let{setError:e,isLoadingLayers:t,setIsLoadingLayers:r}=(0,S.o)(),[n,a]=(0,l.useState)(!1),[o,s]=(0,l.useState)(new Set([E.TROUT_STREAMS,E.STOCKING_LOCATIONS,E.PUBLIC_LAKES])),[c,u]=(0,l.useState)("STREET"),[d,p]=(0,l.useState)(null),[m,g]=(0,l.useState)(!0);(0,l.useEffect)(()=>{a(!0)},[]),(0,l.useEffect)(()=>{(async function(){r(!0),e(null);try{let e=await C();p(e),console.log("ArcGIS data loaded:",{streams:e.streams.length,locations:e.locations.length,lakes:e.lakes.length})}catch(t){console.error("Error loading ArcGIS data:",t),e("Failed to load map data from Virginia DWR")}finally{r(!1)}})()},[r,e]);let h=e=>{s(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},b=e=>{var t;return(null===(t=T[e])||void 0===t?void 0:t.color)||"#6b7280"};if(!n)return(0,i.jsx)("div",{className:"h-[600px] flex items-center justify-center bg-gray-50",children:(0,i.jsx)("p",{children:"Loading map..."})});if(t)return(0,i.jsx)("div",{className:"h-[600px] flex items-center justify-center bg-gray-50",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Loading Virginia DWR TroutApp layers..."}),(0,i.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Connecting to ArcGIS MapServer"})]})});let v=N[c];return(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsxs)("div",{className:"absolute top-4 right-4 z-[1000] bg-white rounded-lg shadow-lg p-4 space-y-3 max-w-xs",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,i.jsx)("h3",{className:"font-semibold text-sm",children:"Map Layers"}),(0,i.jsx)("button",{onClick:()=>g(!m),className:"text-xs text-blue-600 hover:text-blue-800",children:m?"Hide Legend":"Show Legend"})]}),(0,i.jsx)("div",{className:"space-y-2",children:Object.entries(E).slice(0,6).map(e=>{let[,t]=e;return(0,i.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer text-sm",children:[(0,i.jsx)("input",{type:"checkbox",checked:o.has(t),onChange:()=>h(t),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,i.jsx)("span",{className:"flex-1",children:x[t]}),(0,i.jsx)("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:b(t)}})]},t)})}),(0,i.jsxs)("div",{className:"pt-3 border-t border-gray-200",children:[(0,i.jsx)("h4",{className:"font-medium text-xs text-gray-600 mb-2",children:"Base Map"}),(0,i.jsx)("div",{className:"flex gap-1",children:Object.keys(N).map(e=>(0,i.jsx)("button",{onClick:()=>u(e),className:"flex-1 px-2 py-1 text-xs rounded ".concat(c===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:N[e].name},e))})]}),d&&(0,i.jsxs)("div",{className:"pt-3 border-t border-gray-200 text-xs text-gray-600",children:[(0,i.jsxs)("div",{children:["Streams: ",d.streams.length]}),(0,i.jsxs)("div",{children:["Locations: ",d.locations.length]}),(0,i.jsxs)("div",{children:["Lakes: ",d.lakes.length]})]})]}),m&&(0,i.jsxs)("div",{className:"absolute bottom-4 left-4 z-[1000] bg-white rounded-lg shadow-lg p-3 text-xs",children:[(0,i.jsx)("h4",{className:"font-semibold mb-2",children:"Legend"}),(0,i.jsx)("div",{className:"space-y-1",children:Array.from(o).map(e=>(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("div",{className:"w-4 h-1 rounded",style:{backgroundColor:b(e)}}),(0,i.jsx)("span",{className:"text-gray-700",children:x[e]})]},e))})]}),(0,i.jsxs)(f,{center:[37.5,-79.5],zoom:7,style:{height:"600px",width:"100%"},className:"z-0",children:[(0,i.jsx)(y,{attribution:v.attribution,url:v.url,maxZoom:18},c),(0,i.jsx)(w,{activeLayers:o})]}),(0,i.jsxs)("div",{className:"absolute top-4 left-4 z-[1000] bg-blue-50 border border-blue-200 rounded-lg p-3 text-xs max-w-xs",children:[(0,i.jsx)("h4",{className:"font-semibold text-blue-900 mb-1",children:"Virginia DWR TroutApp"}),(0,i.jsx)("p",{className:"text-blue-800",children:"Interactive map showing trout streams, stocking locations, public lakes, and fishing regulations across Virginia."}),(0,i.jsx)("p",{className:"text-blue-700 mt-2 text-[10px]",children:"Data source: Virginia Department of Wildlife Resources ArcGIS MapServer"})]})]})}r(2182)},2182:function(){}}]);